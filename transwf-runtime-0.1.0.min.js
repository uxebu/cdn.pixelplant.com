;(function(){'use strict';function v(e,a){for(var b=0,c=e.length;b<c;b+=1)if(e[b]>a)return b;return e.length}function w(e){var a=this.children=e.children,b=a.length;this._displayList=e;this._clipMap=Array(b);this._flattenedChildren=a.slice();this._nextAddSwfDepth=void 0;this._swfDepthMap=Array(b)}function x(e,a,b,c){if(!e||!e.length)return a;var d=a.slice();d.frameIndex=b;for(var g=0,l=e.length;g<l;g+=1){var f=e[g],h=f.name,m=f.depth;if("PlaceObject"===h||"PlaceObject2"===h||"PlaceObject3"===h){if(!f.isNew&&!f.isModified&&
!f.isReplacement)throw console.log("Crashing tag:",f),Error("Expecting .isModified, .isNew, or .isReplacement (Frame:"+b+", depth:"+m+")");var i=f.isNew?I:a[m],k=f;d[m]=k;k.placementId=f.isModified?i.placementId:++J;f.isModified&&(k.characterId=i.characterId,k.clipDepth=i.clipDepth,k.objectName=i.objectName);"getFilters"in k&&(k.getFilters=Function("filter","return "+k.getFilters));i&&K.forEach(function(a){!(a in k)&&a in i&&(k[a]=i[a])});if(h=c&&c[m]){var f=f.clipActions={},j;for(j in h){var m=L[j],
n=f[m];n||(n=f[m]=[]);n.push(h[j])}}}else"RemoveObject"==h||"RemoveObject2"==h?delete d[m]:console.error("Unrecognized tag type: "+h+", (Frame:"+b+", depth:"+f.depth+")")}return d}function M(e,a){return e&&a?e===a||e.every(function(b,c){return b===a[c]}):e===a}function y(e,a,b){var c=b.characters[e];c&&(c.symbolClass=a,b.vmToplevel.setPreConstructorHook(a,function(a){z.getInstance(e,b,A.initSprite,a)}))}function N(e){var a=e.characters[0].symbolClasses;a&&Object.keys(a).forEach(function(b){var b=
a[b],c;for(c in b)b.hasOwnProperty(c)&&y(c,b[c],e)})}function O(e){var a=e.vmToplevel;a.getType("flash.display.Sprite").prototype.__constructChildren__=B.constructChildren;a.getType("flash.display.MovieClip").prototype.__goto__=function(a,c,d){return B.goto(a,c,d,e)}}function P(e,a,b,c,d){new Q(e,function(){a.once("tick",function(){a.on("tick",function(){C.playFrame(b,c)});C.playFirstFrame(b,c)});a.setFramerate(d)})}var n={};w.prototype={add:function(e,a){var b=this._flattenedChildren,c=b.length;
if(void 0===a||a>c)a=c;b.splice(a,0,e);var d=this._swfDepthMap,g=this._nextAddSwfDepth;d.splice(a,0,g);var l=this._clipMap,f=l[a-1];if(f){var h=f.swfClipDepth,d=d.indexOf(h);-1===d&&(d=c+1);if(g>h||a>d)f=void 0}l.splice(a,0,f);return f?f.displayList.add(e,a-1-b.indexOf(f)):this._displayList.add(e,a)},clear:function(){this._swfDepthMap.length=this._clipMap.length=0;return this._displayList.clear()},contains:function(e){return this._displayList.contains(e)},getSwfObject:function(e){return this._flattenedChildren[this._swfDepthMap.indexOf(e)]},
placeSwfClip:function(e,a,b,c,d,g){e.treeRepresentation=a;a.attr("clip",e);a.swfClipDepth=c;a.__flash__=g;e=this.placeSwfObject(a,b,d,g);b=this._clipMap;c=v(this._swfDepthMap,c);for(d=e;d<c;d+=1)b[d]=a;a.displayList.add(this._flattenedChildren.slice(e+1,c));return e},placeSwfObject:function(e,a,b,c){var d=this._swfDepthMap,g=this._nextAddSwfDepth;this._nextAddSwfDepth=a;a=v(d,a);b&&c?b.addChildAt(c,a-(this._flattenedChildren.length-b.numChildren)):this.add(e,a);this._nextAddSwfDepth=g;return a},remove:function(e){var a=
this._flattenedChildren,b=a.indexOf(e),c;-1!==b&&(c=this._clipMap.splice(b,1)[0],a.splice(b,1),this._swfDepthMap.splice(b,1));return(c?c.displayList:this._displayList).remove(e)},removeSwfObject:function(e){e=this._swfDepthMap.indexOf(e);-1!==e&&this.remove(this.children[e])}};n.module$exports=w;n.module$exports&&(n=n.module$exports);var q={},o=function(e,a){var e=e||[],b,c,d=e.length;this.counter=d;this.success=a||function(){};if(0===d)return this.success(),this;for(b=0;b<d;b++)c=e[b],this["preload"+
c.type](c)};o.prototype={preloadBitmap:function(e){var a=this;(new Bitmap(e.path)).on("load",function(){a.callback()})},preloadFontFamily:function(e){var a=this;(new FontFamily(e.name,[e.path])).on("load",function(){a.callback()})},preloadSound:function(e){var a=this;(new Audio(e.path)).on("load",function(){a.callback()})},callback:function(){this.counter--;0===this.counter&&this.success()}};q.module$exports=o;q.module$exports&&(q=q.module$exports);var o={},K=["matrix","colorTransform","getFilters"],
I={},J=0,L={dragOut:"mouseout",dragOver:"drag",enterFrame:"tick",keyDown:"keydown",keyPress:"keypress",keyUp:"keyup",mouseDown:"pointerdown",mouseMove:"pointermove",mouseUp:"pointerup",press:"pointerdown",release:"pointerup",releaseOutside:"pointerup",rollOut:"mouseout",rollOver:"mouseover"};o.module$exports={preprocessDictionary:function(e,a){for(var b in e){var c=e[b];if("Sprite"===c.type){for(var d=e,g=b,l=c,f=c.frames,h=a&&a[b],m=[],i=0,k=f.length;i<k;i+=1)m=f[i]=x(f[i],m,i,h&&h[i]);l.frames=
f;d[g]=c}}return e},_preProcessFrame:x};o.module$exports&&(o=o.module$exports);var p={module$exports:function(){return self.tools}};p.module$exports&&(p=p.module$exports);var r={},R=n,D=p,E={Bitmap:"flash.display.Bitmap",Button:"flash.display.SimpleButton",Html:"flash.text.TextField",Morph:"flash.display.MorphShape",Shape:"flash.display.Shape",Sprite:"flash.display.MovieClip",Text:"flash.text.StaticText"},u={getInstance:function a(b,c,d,g){var l=c.vmToplevel,f,h=c.characters[b];h.create&&(c.getInstance||
(c.getInstance=function(b){return a(b,c,d)}),f=h.create(c.getInstance));var m=h.type,i=D().getPrivateObjectOf;g?(b=i(g),u.initShimObject(g,b,f)):b=(g=u.createShimObject(m,f,h.symbolClass,l,0===b))&&i(g);b&&(f=b.raw);f.__flash__=g;f.displayList&&(f.displayList=new R(f.displayList));"Sprite"===m&&d(h,f,c);return f},createShimObject:function(a,b,c,d,g){if(!c)if(a in E)c=E[a];else return;a=d.getType(c).prototype;a=Object.create(a,a.__slotDescriptors__);c=D().getPrivateObjectOf(a);c.isRootMovie=!!g;u.initShimObject(a,
c,b);return a},initShimObject:function(a,b,c){c&&(b.raw=c);a.__preConstruct__()}};r.module$exports=u;r.module$exports&&(r=r.module$exports);var n={},F=r,S=Math.max,T=Math.min,j={gotoFrame:function(a,b,c){var d=a.swf,g=d.currentDisplayList||[],b=d.currentDisplayList=d.frames[b],a=d.newChildren=j.updateDisplayList(g,b,a,c);return!(!a||!a.length)},playSwfFrame:function(a,b,c){c||(c=[]);a.isPlaying&&(1===a.length()?a.stop():a.swf&&a.swf.frames&&j.gotoFrame(a,a.currentFrame,b)&&c.push(a));if("function"===
typeof a.children)for(var a=a.children(),d=0,g;g=a[d];d+=1)"swfClipDepth"in g&&j.playSwfFrame(g.attr("clip"),b,c),j.playSwfFrame(g,b,c);return c},styleCharacter:function(a,b,c,d){if(a&&!a.__touchedByActionScript__){var g=c.matrix,l=c.colorTransform,f=c.getFilters,h,m,i,k;d&&(h=d.matrix,m=d.colorTransform,(i=d.getFilters)&&(k=a.attr("filters")));d=f===i?k:f?f(b.filter):null;g!==h&&j.updateMatrix(g,a,b);l!==m&&(d=j.updateColorTransform(l,m,d,a,b));M(d,k)||a.attr("filters",d);(a=a._animation)&&a.step(c.ratio/
65535||0)}},updateMatrix:function(a,b,c){a?b.attr("matrix",new c.Matrix(a.sx,a.rotateSkew0,a.rotateSkew1,a.sy,a.tx,a.ty)):b.attr("matrix",new c.Matrix)},updateColorTransform:function(a,b,c,d,g){b&&(b.isAlphaOnly?d.attr("opacity",b.previousOpacity):c&&(b=c.indexOf(b.filter),-1!==b&&c.splice(b,1)));if(a){var l,f,h,m,i,k,j;(h=a.add)?(b=h.r,l=h.g,f=h.b,h=h.a):b=l=f=h=0;(j=a.mul)?(m=j.r/256,i=j.g/256,k=j.b/256,j=j.a/256):m=i=k=j=1;var n=d.attr("opacity");0===b+l+f&&1===m*i*k?(a.isAlphaOnly=!0,a.previousOpacity=
n,d.attr("opacity",T(1,S(0,n*j+h/255)))):(a=a.filter=new g.filter.ColorMatrix([m,0,0,0,b/255,0,i,0,0,l/255,0,0,k,0,f/255,0,0,0,j,h/255]),c?c.push(a):c=[a])}return c},updateDisplayList:function(a,b,c,d){if(a===b)return null;for(var g=[],l=Math.max(a.length,b.length),f=0;f<l;f+=1)j.updateDisplayListElement(a[f],b[f],f,c,d,g);return g},updateDisplayListElement:function(a,b,c,d,g,l){a!==b&&this.executeUpdateAction(j.getUpdateAction(a,b),a,b,c,d,g,l)},getUpdateAction:function(a,b){return b?a?a.placementId!==
b.placementId?2:3:2:1},executeUpdateAction:function(a,b,c,d,g,l,f){g=g.displayList.getSwfObject(d);3===a?(d=c.clipDepth?g.attr("clip"):g,j.styleCharacter(d,l.bonsai,c,b)):(j.removeCharacter(g,b&&b.objectName),2===a&&(b=F.getInstance(c.characterId,l,j.initSprite),j.styleCharacter(b,l.bonsai,c),j.connectClipActions(b,c.clipActions),f.push({bonsaiObject:b,clipDepth:c.clipDepth,depth:d,objectName:c.objectName})))},initSprite:function(a,b,c){var d=a.frames;b.swf={frameLabels:a.frameLabels||{},frames:d};
b.length&&b.length(d.length);j.gotoFrame(b,0,c)},removeCharacter:function(a,b){if(a){var c=a.__flash__,d=c.parent;d?(d.removeChild(c),b&&(d[b]=null)):a.remove()}},connectClipActions:function(a,b){for(var c in b)for(var d=0,g=b[c].length;d<g;d++)a.on(c,b[c][d])},_dictionary:F};n.module$exports=j;n.module$exports&&(n=n.module$exports);var s={},U=n,G=p,H={constructChildren:function(a,b){var c,d=a.swf;if(d&&d.newChildren){for(var g=d.newChildren,l=0,f;f=g[l];l+=1){var h=f.clipDepth,j=f.bonsaiObject,i=
j.__flash__,k=f.objectName;h?(c=new bonsai.Group,c.attr("data","clip"),a.displayList.placeSwfClip(j,c,f.depth,h,b,i)):a.displayList.placeSwfObject(j,f.depth,b,i);i&&(k&&(i[G().expando].name=k),i.constructor(),k&&i[G().expando].raw.attr("data","objectName = "+k));k&&((c=Object.getOwnPropertyDescriptor(b,k))&&!c.configurable?(b[k]=i,b[k.toLowerCase()]=i):(Object.defineProperty(b,k,{configurable:!0,writable:!0,value:i}),Object.defineProperty(b,k.toLowerCase(),{configurable:!0,writable:!0,value:i})))}d.newChildren=
null}},"goto":function(a,b,c,d){U.gotoFrame(a,b,d)&&H.constructChildren(a,c)}};s.module$exports=H;s.module$exports&&(s=s.module$exports);var t={},V=n,W=s.constructChildren;t.module$exports={playFirstFrame:function(a,b){var c=a.__flash__;b.vmToplevel.global.stage.addChildAt(c,0);c.constructor()},playFrame:function(a,b){for(var c=V.playSwfFrame(a,b),d=0,g;g=c[d];d+=1)W(g,g.__flash__)}};t.module$exports&&(t=t.module$exports);var p={},z=r,Q=q,B=s,C=t,A=n,q={playSwf:function(a,b,c,d){var g=a.bonsai.stage;
g.setBackgroundColor(c);N(a);g.options.flashConfig||(g.options.flashConfig={});var j={};d.forEach(function(a){"Sound"==a.type&&(j[a.name]=a.path)});g.options.flashConfig.exportAssets={sounds:j};g.toplevel=a.vmToplevel;c=z.getInstance(0,a,A.initSprite);O(a);P(d,g,c,a,b);return c},preprocessDictionary:o.preprocessDictionary,_registerSymbolClass:y},o=Function("return this")();o.exports=o.exports||{};o.exports.transwf=q;p.module$exports=q;p.module$exports&&(p=p.module$exports)})();
