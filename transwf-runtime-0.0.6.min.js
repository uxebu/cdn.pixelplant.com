;(function(){'use strict';function v(e,a){for(var b=0,c=e.length;b<c;b+=1)if(e[b]>a)return b;return e.length}function w(e){var a=this.children=e.children,b=a.length;this._displayList=e;this._clipMap=Array(b);this._flattenedChildren=a.slice();this._nextAddSwfDepth=void 0;this._swfDepthMap=Array(b)}function x(e,a,b){if(!e||!e.length)return a;var c=a.slice();c.frameIndex=b;for(var d=0,f=e.length;d<f;d+=1){var h=e[d],g=h.name,i=h.depth;if("PlaceObject"===g||"PlaceObject2"===g||"PlaceObject3"===g){if(!h.isNew&&!h.isModified&&
!h.isReplacement)throw console.log("Crashing tag:",h),Error("Expecting .isModified, .isNew, or .isReplacement (Frame:"+b+", depth:"+i+")");var m=h.isNew?H:a[i],j=h;c[i]=j;j.placementId=h.isModified?m.placementId:++I;h.isModified&&(j.characterId=m.characterId,j.clipDepth=m.clipDepth,j.objectName=m.objectName);"getFilters"in j&&(j.getFilters=Function("filter","return "+j.getFilters));J.forEach(function(a){!(a in j)&&a in m&&(j[a]=m[a])})}else"RemoveObject"==g||"RemoveObject2"==g?delete c[i]:console.error("Unrecognized tag type: "+
g+", (Frame:"+b+", depth:"+h.depth+")")}return c}function K(){this.stop()}function L(e,a){return e&&a?e===a||e.every(function(b,c){return b===a[c]}):e===a}function y(e,a,b){var c=b.characters[e];c&&(c.symbolClass=a,b.vmToplevel.setPreConstructorHook(a,function(a){z.getInstance(e,b,A.initSprite,a)}))}function M(e){var a=e.characters[0].symbolClasses;a&&Object.keys(a).forEach(function(b){var b=a[b],c;for(c in b)b.hasOwnProperty(c)&&y(c,b[c],e)})}function N(e){var a=e.vmToplevel;a.getType("flash.display.Sprite").prototype.__constructChildren__=
B.constructChildren;a.getType("flash.display.MovieClip").prototype.__goto__=function(a,c,d){return B.goto(a,c,d,e)}}function O(e,a,b,c,d){new P(e,function(){a.once("tick",function(){a.on("tick",function(){C.playFrame(b,c)});C.playFirstFrame(b,c)});a.setFramerate(d)})}var l={};w.prototype={add:function(e,a){var b=this._flattenedChildren,c=b.length;if(void 0===a||a>c)a=c;b.splice(a,0,e);var d=this._swfDepthMap,f=this._nextAddSwfDepth;d.splice(a,0,f);var h=this._clipMap,g=h[a-1];if(g){var i=g.swfClipDepth,
d=d.indexOf(i);-1===d&&(d=c+1);if(f>i||a>d)g=void 0}h.splice(a,0,g);return g?g.displayList.add(e,a-1-b.indexOf(g)):this._displayList.add(e,a)},clear:function(){this._swfDepthMap.length=this._clipMap.length=0;return this._displayList.clear()},contains:function(e){return this._displayList.contains(e)},getSwfObject:function(e){return this._flattenedChildren[this._swfDepthMap.indexOf(e)]},placeSwfClip:function(e,a,b,c,d,f){e.treeRepresentation=a;a.attr("clip",e);a.swfClipDepth=c;a.__flash__=f;e=this.placeSwfObject(a,
b,d,f);b=this._clipMap;c=v(this._swfDepthMap,c);for(d=e;d<c;d+=1)b[d]=a;a.displayList.add(this._flattenedChildren.slice(e+1,c));return e},placeSwfObject:function(e,a,b,c){var d=this._swfDepthMap,f=this._nextAddSwfDepth;this._nextAddSwfDepth=a;a=v(d,a);b&&c?b.addChildAt(c,a-(this._flattenedChildren.length-b.numChildren)):this.add(e,a);this._nextAddSwfDepth=f;return a},remove:function(e){var a=this._flattenedChildren,b=a.indexOf(e),c;-1!==b&&(c=this._clipMap.splice(b,1)[0],a.splice(b,1),this._swfDepthMap.splice(b,
1));return(c?c.displayList:this._displayList).remove(e)},removeSwfObject:function(e){e=this._swfDepthMap.indexOf(e);-1!==e&&this.remove(this.children[e])}};l.module$exports=w;l.module$exports&&(l=l.module$exports);var p={},k=function(e,a){var e=e||[],b,c,d=e.length;this.counter=d;this.success=a||function(){};if(0===d)return this.success(),this;for(b=0;b<d;b++)c=e[b],this["preload"+c.type](c)};k.prototype={preloadBitmap:function(e){var a=this;(new Bitmap(e.path)).on("load",function(){a.callback()})},
preloadFontFamily:function(e){var a=this;(new FontFamily(e.name,[e.path])).on("load",function(){a.callback()})},callback:function(){this.counter--;0===this.counter&&this.success()}};p.module$exports=k;p.module$exports&&(p=p.module$exports);var k={},J=["matrix","colorTransform","getFilters","nonInteractive"],H={},I=0;k.module$exports={preprocessDictionary:function(e){for(var a in e){var b=e[a];if("Sprite"===b.type){for(var c=e,d=a,f=b,h=b.frames,g=[],i=0,m=h.length;i<m;i+=1)g=h[i]=x(h[i],g,i);f.frames=
h;c[d]=b}}return e},_preProcessFrame:x};k.module$exports&&(k=k.module$exports);var o={module$exports:function(){return self.tools}};o.module$exports&&(o=o.module$exports);var q={},Q=l,D=o,E={Bitmap:"flash.display.Bitmap",Button:"flash.display.SimpleButton",Html:"flash.text.TextField",Morph:"flash.display.MorphShape",Shape:"flash.display.Shape",Sprite:"flash.display.MovieClip",Text:"flash.text.StaticText"},t={getInstance:function a(b,c,d,f){var h=c.vmToplevel,g,i=c.characters[b];i.create&&(c.getInstance||
(c.getInstance=function(b){return a(b,c,d)}),g=i.create(c.getInstance));var m=i.type,j=D().getPrivateObjectOf;f?(b=j(f),t.initShimObject(f,b,g)):b=(f=t.createShimObject(m,g,i.symbolClass,h,0===b))&&j(f);b&&(g=b.raw);g.__flash__=f;g.displayList&&(g.displayList=new Q(g.displayList));"Sprite"===m&&d(i,g,c);return g},createShimObject:function(a,b,c,d,f){if(!c)if(a in E)c=E[a];else return;a=d.getType(c).prototype;a=Object.create(a,a.__slotDescriptors__);c=D().getPrivateObjectOf(a);c.isRootMovie=!!f;t.initShimObject(a,
c,b);return a},initShimObject:function(a,b,c){c&&(b.raw=c);a.__preConstruct__()}};q.module$exports=t;q.module$exports&&(q=q.module$exports);var l={},F=q,R=Math.max,S=Math.min,n={gotoFrame:function(a,b,c){var d=a.swf,f=d.currentDisplayList||[],b=d.currentDisplayList=d.frames[b],a=d.newChildren=n.updateDisplayList(f,b,a,c);return!(!a||!a.length)},playSwfFrame:function(a,b,c){c||(c=[]);a.isPlaying&&(1===a.length()?a.stop():a.swf&&a.swf.frames&&n.gotoFrame(a,a.currentFrame,b)&&c.push(a));if("function"===
typeof a.children)for(var a=a.children(),d=0,f;f=a[d];d+=1)"swfClipDepth"in f&&n.playSwfFrame(f.attr("clip"),b,c),n.playSwfFrame(f,b,c);return c},styleCharacter:function(a,b,c,d){if(a&&!a.__touchedByActionScript__){var f=c.matrix,h=c.colorTransform,g=c.getFilters,i=!!c.nonInteractive,m,j,l,u,k=!1;d&&(m=d.matrix,j=d.colorTransform,(l=d.getFilters)&&(u=a.attr("filters")),k=!!d.nonInteractive);d=g===l?u:g?g(b.filter):null;f!==m&&n.updateMatrix(f,a,b);h!==j&&(d=n.updateColorTransform(h,j,d,a,b));L(d,
u)||a.attr("filters",d);i!==k&&a.attr("interactive",!i);(a=a._animation)&&a.step(c.ratio/65535||0)}},updateMatrix:function(a,b,c){a?b.attr("matrix",new c.Matrix(a.sx,a.rotateSkew0,a.rotateSkew1,a.sy,a.tx,a.ty)):b.attr("matrix",new c.Matrix)},updateColorTransform:function(a,b,c,d,f){b&&(b.isAlphaOnly?d.attr("opacity",b.previousOpacity):c&&(b=c.indexOf(b.filter),-1!==b&&c.splice(b,1)));if(a){var h,g,i,m,j,l,k;(i=a.add)?(b=i.r,h=i.g,g=i.b,i=i.a):b=h=g=i=0;(k=a.mul)?(m=k.r/256,j=k.g/256,l=k.b/256,k=k.a/
256):m=j=l=k=1;var n=d.attr("opacity");0===b+h+g&&1===m*j*l?(a.isAlphaOnly=!0,a.previousOpacity=n,d.attr("opacity",S(1,R(0,n*k+i/255)))):(a=a.filter=new f.filter.ColorMatrix([m,0,0,0,b/255,0,j,0,0,h/255,0,0,l,0,g/255,0,0,0,k,i/255]),c?c.push(a):c=[a])}return c},updateDisplayList:function(a,b,c,d){if(a===b)return null;for(var f=[],h=Math.max(a.length,b.length),g=0;g<h;g+=1)n.updateDisplayListElement(a[g],b[g],g,c,d,f);return f},updateDisplayListElement:function(a,b,c,d,f,h){a!==b&&this.executeUpdateAction(n.getUpdateAction(a,
b),a,b,c,d,f,h)},getUpdateAction:function(a,b){return b?a?a.placementId!==b.placementId?2:3:2:1},executeUpdateAction:function(a,b,c,d,f,h,g){f=f.displayList.getSwfObject(d);3===a?(d=c.clipDepth?f.attr("clip"):f,n.styleCharacter(d,h.bonsai,c,b)):(n.removeCharacter(f,b&&b.objectName),2===a&&(b=F.getInstance(c.characterId,h,n.initSprite),n.styleCharacter(b,h.bonsai,c),g.push({bonsaiObject:b,clipDepth:c.clipDepth,depth:d,objectName:c.objectName})))},initSprite:function(a,b,c){var d=a.frames;b.swf={frameLabels:a.frameLabels||
{},frames:d};if(b.length){b.length(d.length);for(var d=(a=a.stopCalls)?a.length:0,f=0;f<d;f+=1)b.on(a[f],K)}n.gotoFrame(b,0,c)},removeCharacter:function(a,b){if(a){var c=a.__flash__,d=c.parent;d?(d.removeChild(c),b&&(d[b]=null)):a.remove()}},_dictionary:F};l.module$exports=n;l.module$exports&&(l=l.module$exports);var r={},T=l,U=o,G={constructChildren:function(a,b){var c,d=a.swf;if(d&&d.newChildren){for(var f=d.newChildren,h=0,g;g=f[h];h+=1){var i=g.clipDepth,k=g.bonsaiObject,j=k.__flash__,l=g.objectName;
i?(c=new bonsai.Group,c.attr("data","clip"),a.displayList.placeSwfClip(k,c,g.depth,i,b,j)):a.displayList.placeSwfObject(k,g.depth,b,j);j&&(l&&(j[U().expando].name=l),j.constructor());l&&Object.defineProperty(b,l,{configurable:!0,writable:!0,value:j})}d.newChildren=null}},"goto":function(a,b,c,d){T.gotoFrame(a,b,d)&&G.constructChildren(a,c)}};r.module$exports=G;r.module$exports&&(r=r.module$exports);var s={},V=l,W=r.constructChildren;s.module$exports={playFirstFrame:function(a,b){var c=a.__flash__;
b.vmToplevel.global.stage.addChildAt(c,0);c.constructor()},playFrame:function(a,b){for(var c=V.playSwfFrame(a,b),d=0,f;f=c[d];d+=1)W(f,f.__flash__)}};s.module$exports&&(s=s.module$exports);var o={},z=q,P=p,B=r,C=s,A=l,p={playSwf:function(a,b,c,d){var f=a.bonsai.stage;f.setBackgroundColor(c);M(a);f.toplevel=a.vmToplevel;c=z.getInstance(0,a,A.initSprite);N(a);O(d,f,c,a,b);return c},preprocessDictionary:k.preprocessDictionary,_registerSymbolClass:y},k=Function("return this")();k.exports=k.exports||{};
k.exports.transwf=p;o.module$exports=p;o.module$exports&&(o=o.module$exports)})();
